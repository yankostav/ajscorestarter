"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var Rx_1 = require("rxjs/Rx");
var analyticsData_1 = require("../models/analyticsData");
var BaseServices = (function () {
    function BaseServices(http) {
        this.http = http;
        if (!this.getLocalStorage("analyticsData")) {
            var analyticsData = new analyticsData_1.AnalyticsData();
            analyticsData.exceptions = new Array();
            analyticsData.performances = new Array();
            this.setLocalStorage("analyticsData", analyticsData);
        }
    }
    BaseServices.prototype.httpGet = function (controller, success, error) {
        this.get(controller)
            .subscribe(function (obj) { success(obj); }, function (errorMessage) {
            error(errorMessage);
        });
    };
    BaseServices.prototype.get = function (controller) {
        return this.http.get("api/" + controller)
            .map(function (response) { return response.json(); })
            .catch(this.handleError);
    };
    BaseServices.prototype.httpPost = function (object, controller, success, error) {
        this.post(object, controller)
            .subscribe(function (obj) { success(obj); }, function (errorMessage) {
            error(errorMessage);
        });
    };
    BaseServices.prototype.post = function (object, controller) {
        return this.http.post("api/" + controller, object)
            .map(function (response) { return response.json(); })
            .catch(this.handleError);
    };
    BaseServices.prototype.httpDelete = function (controller, success, error) {
        this.delete(controller)
            .subscribe(function (obj) { success(obj); }, function (errorMessage) {
            error(errorMessage);
        });
    };
    BaseServices.prototype.delete = function (controller) {
        return this.http.delete("api/" + controller)
            .map(function (response) { return response.json(); })
            .catch(this.handleError);
    };
    BaseServices.prototype.handleError = function (error, caught) {
        if (error.status !== 502 && error.status !== 0) {
            var analyticsData = JSON.parse(localStorage.getItem("analyticsData"));
            if (analyticsData.exceptions.length > 99) {
                analyticsData.exceptions.pop();
            }
            var exception = new analyticsData_1.Exception();
            exception.date = new Date();
            exception.errorMessage = error._body;
            analyticsData.exceptions.unshift(exception);
            localStorage.setItem("analyticsData", JSON.stringify(analyticsData));
        }
        return Rx_1.Observable.throw(error._body);
    };
    BaseServices.prototype.setLocalStorage = function (name, anyObject) {
        if (anyObject instanceof Array) {
            anyObject = { array: anyObject };
        }
        if (typeof (anyObject) == "object") {
            var stringVal = JSON.stringify(anyObject);
            if (stringVal)
                localStorage.setItem(name, stringVal);
        }
    };
    BaseServices.prototype.getLocalStorage = function (name) {
        var value = localStorage.getItem(name);
        if (!value)
            return null;
        if (value.substring(0, 1) === "{") {
            var obj = JSON.parse(value);
            if ("array" in obj)
                return obj.array;
            return obj;
        }
        return null;
    };
    return BaseServices;
}());
exports.BaseServices = BaseServices;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZVNlcnZpY2VzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYmFzZVNlcnZpY2VzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsOEJBQXFDO0FBR3JDLHlEQUFnRjtBQUVoRjtJQUVJLHNCQUE0QixJQUFVO1FBQVYsU0FBSSxHQUFKLElBQUksQ0FBTTtRQUNsQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3pDLElBQU0sYUFBYSxHQUFHLElBQUksNkJBQWEsRUFBRSxDQUFDO1lBQzFDLGFBQWEsQ0FBQyxVQUFVLEdBQUcsSUFBSSxLQUFLLEVBQWEsQ0FBQztZQUNsRCxhQUFhLENBQUMsWUFBWSxHQUFHLElBQUksS0FBSyxFQUFlLENBQUM7WUFDdEQsSUFBSSxDQUFDLGVBQWUsQ0FBQyxlQUFlLEVBQUUsYUFBYSxDQUFDLENBQUM7UUFDekQsQ0FBQztJQUNMLENBQUM7SUFFRCw4QkFBTyxHQUFQLFVBQVEsVUFBa0IsRUFBRSxPQUFPLEVBQUUsS0FBSztRQUN0QyxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQzthQUNmLFNBQVMsQ0FDVixVQUFBLEdBQUcsSUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUEsQ0FBQyxDQUFDLEVBQ3ZCLFVBQUEsWUFBWTtZQUNSLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUN4QixDQUFDLENBQUMsQ0FBQztJQUNYLENBQUM7SUFFTywwQkFBRyxHQUFYLFVBQVksVUFBVTtRQUNsQixNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBTyxVQUFZLENBQUM7YUFDcEMsR0FBRyxDQUFDLFVBQUMsUUFBa0IsSUFBSyxPQUFLLFFBQVEsQ0FBQyxJQUFJLEVBQUUsRUFBcEIsQ0FBb0IsQ0FBQzthQUNqRCxLQUFLLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ2pDLENBQUM7SUFF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QztZQUNqQyxJQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQzVDLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQztnQkFDVixZQUFZLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQztRQUM5QyxDQUFDO0lBQ0wsQ0FBQztJQUVELHNDQUFlLEdBQWYsVUFBZ0IsSUFBWTtRQUN4QixJQUFNLEtBQUssR0FBRyxZQUFZLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3pDLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1lBQ1AsTUFBTSxDQUFDLElBQUksQ0FBQztRQUNoQixFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ2hDLElBQU0sR0FBRyxHQUFRLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDbkMsRUFBRSxDQUFDLENBQUMsT0FBTyxJQUFJLEdBQUcsQ0FBQztnQkFDZixNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQztZQUNyQixNQUFNLENBQUMsR0FBRyxDQUFDO1FBQ2YsQ0FBQztRQUNELE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUNMLG1CQUFDO0FBQUQsQ0FBQyxBQTdGRCxJQTZGQztBQTdGWSxvQ0FBWSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tIFwicnhqcy9SeFwiO1xyXG5pbXBvcnQgeyBDdXN0b21SZXNwb25zZSB9IGZyb20gXCIuLi9tb2RlbHMvY3VzdG9tUmVzcG9uc2VcIjtcclxuaW1wb3J0IHsgSHR0cCwgUmVzcG9uc2UsIEhlYWRlcnMsIFJlcXVlc3RPcHRpb25zIH0gZnJvbSBcIkBhbmd1bGFyL2h0dHBcIjtcclxuaW1wb3J0IHsgQW5hbHl0aWNzRGF0YSwgRXhjZXB0aW9uLCBQZXJmb3JtYW5jZSB9IGZyb20gXCIuLi9tb2RlbHMvYW5hbHl0aWNzRGF0YVwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIEJhc2VTZXJ2aWNlcyB7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHVibGljIHJlYWRvbmx5IGh0dHA6IEh0dHApIHtcclxuICAgICAgICBpZiAoIXRoaXMuZ2V0TG9jYWxTdG9yYWdlKFwiYW5hbHl0aWNzRGF0YVwiKSkge1xyXG4gICAgICAgICAgICBjb25zdCBhbmFseXRpY3NEYXRhID0gbmV3IEFuYWx5dGljc0RhdGEoKTtcclxuICAgICAgICAgICAgYW5hbHl0aWNzRGF0YS5leGNlcHRpb25zID0gbmV3IEFycmF5PEV4Y2VwdGlvbj4oKTtcclxuICAgICAgICAgICAgYW5hbHl0aWNzRGF0YS5wZXJmb3JtYW5jZXMgPSBuZXcgQXJyYXk8UGVyZm9ybWFuY2U+KCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0TG9jYWxTdG9yYWdlKFwiYW5hbHl0aWNzRGF0YVwiLCBhbmFseXRpY3NEYXRhKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaHR0cEdldChjb250cm9sbGVyOiBzdHJpbmcsIHN1Y2Nlc3MsIGVycm9yKSB7XHJcbiAgICAgICAgdGhpcy5nZXQoY29udHJvbGxlcilcclxuICAgICAgICAgICAgLnN1YnNjcmliZShcclxuICAgICAgICAgICAgb2JqID0+IHsgc3VjY2VzcyhvYmopIH0sXHJcbiAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9PiB7XHJcbiAgICAgICAgICAgICAgICBlcnJvcihlcnJvck1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldChjb250cm9sbGVyKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldChgYXBpLyR7Y29udHJvbGxlcn1gKVxyXG4gICAgICAgICAgICAubWFwKChyZXNwb25zZTogUmVzcG9uc2UpID0+IDxhbnk+cmVzcG9uc2UuanNvbigpKVxyXG4gICAgICAgICAgICAuY2F0Y2godGhpcy5oYW5kbGVFcnJvcik7XHJcbiAgICB9XHJcblxyXG4gICAgaHR0cFBvc3Qob2JqZWN0OiBhbnksIGNvbnRyb2xsZXI6IHN0cmluZywgc3VjY2VzcywgZXJyb3IpIHtcclxuICAgICAgICB0aGlzLnBvc3Qob2JqZWN0LCBjb250cm9sbGVyKVxyXG4gICAgICAgICAgICAuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICBvYmogPT4geyBzdWNjZXNzKG9iaikgfSxcclxuICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0+IHtcclxuICAgICAgICAgICAgICAgIGVycm9yKGVycm9yTWVzc2FnZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcG9zdChvYmplY3Q6IGFueSwgY29udHJvbGxlcjogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5odHRwLnBvc3QoYGFwaS8ke2NvbnRyb2xsZXJ9YCwgb2JqZWN0KVxyXG4gICAgICAgICAgICAubWFwKChyZXNwb25zZTogUmVzcG9uc2UpID0+IDxhbnk+cmVzcG9uc2UuanNvbigpKVxyXG4gICAgICAgICAgICAuY2F0Y2godGhpcy5oYW5kbGVFcnJvcik7XHJcbiAgICB9XHJcblxyXG4gICAgaHR0cERlbGV0ZShjb250cm9sbGVyOiBzdHJpbmcsIHN1Y2Nlc3MsIGVycm9yKSB7XHJcbiAgICAgICAgdGhpcy5kZWxldGUoY29udHJvbGxlcilcclxuICAgICAgICAgICAgLnN1YnNjcmliZShcclxuICAgICAgICAgICAgb2JqID0+IHsgc3VjY2VzcyhvYmopIH0sXHJcbiAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9PiB7XHJcbiAgICAgICAgICAgICAgICBlcnJvcihlcnJvck1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBkZWxldGUoY29udHJvbGxlcjogc3RyaW5nKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5kZWxldGUoYGFwaS8ke2NvbnRyb2xsZXJ9YClcclxuICAgICAgICAgICAgLm1hcCgocmVzcG9uc2U6IFJlc3BvbnNlKSA9PiA8YW55PnJlc3BvbnNlLmpzb24oKSlcclxuICAgICAgICAgICAgLmNhdGNoKHRoaXMuaGFuZGxlRXJyb3IpO1xyXG4gICAgfVxyXG5cclxuICAgIGhhbmRsZUVycm9yKGVycm9yOiBDdXN0b21SZXNwb25zZSwgY2F1Z2h0OiBPYnNlcnZhYmxlPGFueT4pOiBhbnkge1xyXG4gICAgICAgIGlmIChlcnJvci5zdGF0dXMgIT09IDUwMiAmJiBlcnJvci5zdGF0dXMgIT09IDApIHsgLy8gYmFkIGdhdGV3YXkgaXMgYW4gZXhwZWN0ZWQgZXhjZXB0aW9uXHJcbiAgICAgICAgICAgIGNvbnN0IGFuYWx5dGljc0RhdGE6IEFuYWx5dGljc0RhdGEgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiYW5hbHl0aWNzRGF0YVwiKSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoYW5hbHl0aWNzRGF0YS5leGNlcHRpb25zLmxlbmd0aCA+IDk5KSB7XHJcbiAgICAgICAgICAgICAgICBhbmFseXRpY3NEYXRhLmV4Y2VwdGlvbnMucG9wKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3QgZXhjZXB0aW9uID0gbmV3IEV4Y2VwdGlvbigpOyBleGNlcHRpb24uZGF0ZSA9IG5ldyBEYXRlKCk7IGV4Y2VwdGlvbi5lcnJvck1lc3NhZ2UgPSBlcnJvci5fYm9keTtcclxuICAgICAgICAgICAgYW5hbHl0aWNzRGF0YS5leGNlcHRpb25zLnVuc2hpZnQoZXhjZXB0aW9uKTtcclxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJhbmFseXRpY3NEYXRhXCIsIEpTT04uc3RyaW5naWZ5KGFuYWx5dGljc0RhdGEpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIE9ic2VydmFibGUudGhyb3coZXJyb3IuX2JvZHkpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldExvY2FsU3RvcmFnZShuYW1lOiBzdHJpbmcsIGFueU9iamVjdDogYW55KTogdm9pZCB7XHJcbiAgICAgICAgaWYgKGFueU9iamVjdCBpbnN0YW5jZW9mIEFycmF5KSB7XHJcbiAgICAgICAgICAgIGFueU9iamVjdCA9IHsgYXJyYXk6IGFueU9iamVjdCB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZW9mIChhbnlPYmplY3QpID09IFwib2JqZWN0XCIpIHtcclxuICAgICAgICAgICAgY29uc3Qgc3RyaW5nVmFsID0gSlNPTi5zdHJpbmdpZnkoYW55T2JqZWN0KTtcclxuICAgICAgICAgICAgaWYgKHN0cmluZ1ZhbClcclxuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKG5hbWUsIHN0cmluZ1ZhbCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldExvY2FsU3RvcmFnZShuYW1lOiBzdHJpbmcpOiBhbnkge1xyXG4gICAgICAgIGNvbnN0IHZhbHVlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0obmFtZSk7XHJcbiAgICAgICAgaWYgKCF2YWx1ZSlcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgaWYgKHZhbHVlLnN1YnN0cmluZygwLCAxKSA9PT0gXCJ7XCIpIHtcclxuICAgICAgICAgICAgY29uc3Qgb2JqOiBhbnkgPSBKU09OLnBhcnNlKHZhbHVlKTtcclxuICAgICAgICAgICAgaWYgKFwiYXJyYXlcIiBpbiBvYmopXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb2JqLmFycmF5O1xyXG4gICAgICAgICAgICByZXR1cm4gb2JqO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxufSJdfQ==